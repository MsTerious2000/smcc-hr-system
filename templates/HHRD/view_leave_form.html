{% set active_page = "pending_leave" %}
{% extends "HHRD/header.html" %}
{% block index %}
<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">View Leave Form</h6>
        <!-- <a href="#" class="btn btn-success btn-sm" id="submit_btn"><i class="fas fa-paper-plane"></i> SUBMIT</a> -->
    </div>

    <!-- Card Body -->
    <div class="card-body" id="printableArea">
        <form id="submit-form">
            <center>
                <h4><b>Saint Michael College of Caraga</b></h4>
                <h6>Brgy. 4, Nasipit, Agusan del Norte, Philippines<br>Tel. No. +63 065 343-3251 / +63 005 283-3112 Fax
                    Np.
                    +63 085 008-0892<br><u>www.smccnasipit.edu.ph</u></h6>
                <br>
                <h4 style="font-weight: bolder;">LEAVE FORM</h4>
            </center>
            <br>

            <div class="row">
                <div class="col-sm-6">
                    <p><b>Name:</b>
                        <input type="text" class="inpt" name="fullname" value="{{data[2]}}"
                            style="width: 250px; margin-left: 55px;" readonly>
                    </p>
                    <p><b>Designation:</b>
                        <input type="text" class="inpt" id="designation" name="designation" value="{{data[3]}}"
                            style="width: 250px; margin-left: 10px;" readonly>
                    </p>
                    <p><b>Date Filed:</b>
                        <input type="text" class="inpt" id="date_filed" name="date_filed" value="{{data[4]}}"
                            style="width: 250px; margin-left: 20px;" readonly>
                    </p>
                    <p><b>Reasons:</b>
                        <textarea name="reasons" id="reasons" style="width: 400px; margin-left: 35px;" readonly>{{ data[5] }}</textarea>
                    </p>
                    <br><br>
                    <br><br>
                    <br><br>
                    <p style="font-weight:bolder;">Inlusive Date of Leave:</p>
                    <p>From:
                        <input type="text" class="inpt" name="from" value="{{data[6]}}" style="width: 250px; margin-left: 35px;" readonly>
                    </p>
                    <p>To:
                        <input type="text" class="inpt" name="to" value="{{data[7]}}" style="width: 250px; margin-left: 55px;" readonly>
                    </p>
                </div>

                <div class="col-sm-6">
                    <div style="border:1px dashed black; padding: 10px;">
                        <p style="font-weight:bolder;">Nature of Leave:
                        </p>
                        <p>	<input type="radio" name="nature_of_leave" value="(SIL) Service Incentive Leave" {% if data[8] == '(SIL) Service Incentive Leave' %} checked="checked" {% endif %}> 
							(SIL) Service Incentive Leave
						</p>
                        <p><input type="radio" name="nature_of_leave" value="(SL) Study Leave" {% if data[8] == '(SL) Study Leave' %} checked="checked" {% endif %}> 
							(SL) Study Leave</p>
                        <p><input type="radio" name="nature_of_leave" value="(ML) Maternity Leave" {% if data[8] == '(ML) Maternity Leave' %} checked="checked" {% endif %}> 
							(ML) Maternity Leave</p>
                        <p><input type="radio" name="nature_of_leave" value="(PL) Paternity Leave" {% if data[8] == '(PL) Paternity Leave' %} checked="checked" {% endif %}> 
							(PL) Paternity Leave</p>
                        <p><input type="radio" name="nature_of_leave" value="(PLSP) Parental Leave for Solo Parent" {% if data[8] == '(PLSP) Parental Leave for Solo Parent' %} checked="checked" {% endif %}> 
							(PLSP) Parental Leave for Solo Parent</p>
                        <p><input type="radio" name="nature_of_leave" value="Sick Leave" {% if data[8] == 'Sick Leave' %} checked="checked" {% endif %}> 
                            Sick Leave</p>
                        <p><input type="radio" name="nature_of_leave" value="Others" {% if data[8] == 'Others' %} checked="checked" {% endif %}> 
							Others: <input type="text" class="inpt" name="others" value="{{data[9]}}"></p>
                    </div>
                    <br><br>
                    <p>Number of Day(s):
                        <input type="text" class="inpt" min="1" name="number_of_days" style="width: 250px; margin-left: 5px;" value="{{data[10]}}" readonly>
                    </p>
                    <p>Return Date:
                        <input type="date" class="inpt" name="return_date" style="width: 250px; margin-left: 45px;" value="{{data[11]}}" readonly>
                    </p>
                </div>
            </div>

            <p style="font-weight:bolder;">Note: Shall return back to work on the said
                date, if it is not possible to return on the said date due to emergency inform the Department Head of
                his/her approval for extension of leave and report it to Human Resource Office.</p>
            <br>
            <br>
            <div class="row">
                <div class="col-sm-6">
                    <center>
                        <p><input type="text" required class="inpt" name="employee_name_signature" value="{{data[12]}}" readonly style="text-align:center;" ><br>
                            Employee's Name and Signature</p><br>
                        <p>Recommending Approval By:<br><br>
                            <input type="text" required class="inpt" name="head_human_resource_department" {% if data[13] %} value="{{data[13]}}" {% else %} value="{{info[1]}} {{info[2]}}" {% endif %} readonly style="text-align:center;" ><br>
                            Head Human Resource Development
                        </p><br><br>
                    </center>
                </div>
                <div class="col-sm-6">
                    <center>
                        <p><input type="text" class="inpt" name="department_head" {% if data[14] %} value="{{data[14]}}" {% else %} value="" {% endif %} readonly style="text-align:center;" ><br>
                            Department Head's Approval</h3><br><br><br><br>
                        <p><input type="text" class="inpt" name="school_president" {% if data[15] %} value="{{data[15]}}" {% else %} value="" {% endif %} readonly style="text-align:center;" ><br>
                            School President</h3><br>
                    </center>
                </div>
            </div>
            <div class="pull-right" style="font-weight:bolder; border: 1px solid black; padding: 10px;">
                Note: Provide 2 copies, 1 for Human Resource, 2<sup>nd</sup> Personal Copy
            </div>

            <div class="btn-group-vertical" style="position:fixed; top:100px; right:30px;">
				<a class="btn btn-primary btn-sm" id="print" onclick="printDiv('printableArea')"><i class="fas fa-print"></i> PRINT</a>
                {% if data[16] == 'HHRD' %}
                    <a class="btn btn-success btn-sm" id="submit_btn"><i class="fas fa-check"></i> APPROVE</a>
                    <button type="button" title="Cancel" class="btn btn-danger btn-sm" id="dissaprove"><i class="fas fa-thumbs-down"></i> DISAPPROVE</button>
                    <!-- <a href="/dissaprove/{{data[0]}}/{{info[1]}}/{{info[2]}}/view_hhrd_leave_forms/leave_form" class="btn btn-danger btn-sm"><i class="fas fa-thumbs-down"></i> DISAPPROVE</a> -->
                    <button type="submit" id="submit" style="display: none;"></button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<style type="text/css">
    @media print {
        body * {
            visibility: hidden;
        }

        #section-to-print,
        #section-to-print * {
            visibility: visible;
        }

        #section-to-print {
            width: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }
    }

    .inpt {
        border: none;
        border-bottom: 1px solid black;
    }

    .inpt:focus {
        outline: none;
        border-bottom: 1px solid red;
    }

    select {
        all: unset;
        padding-right: 15px;
        border-bottom: 1px solid;
        background: url('static/img/dropdown.png') no-repeat right;
        background-size: 16px;
        color: black;
    }
</style>
<script src="{{url_for('static',filename='vendor/jquery/jquery-3.5.1.min.js')}}"></script>

<script type="text/javascript">
    $(':radio:not(:checked)').attr('disabled', true);
    
    function setVisible(selector, visible) {
        document.querySelector(selector).style.display = visible ? 'block' : 'none';
    }

    $('#submit-form').submit(function(e){
        e.preventDefault();
        const url = '/hhrd_approve_leave_form/{{data[0]}}';
        var formData = new FormData(this);
        $.ajax({
            data : formData,
            url  : url,
            type : 'POST',
            cache		: false,
            contentType	: false,
            processData	: false,
            beforeSend: function(){
                console.log('loading');
                setVisible('#loading', true);
            },
            complete: function(){
                console.log('done');
                setVisible('#loading', false);
            },
            success: function(response){
                if(response.data == 'success') {
                    window.location.href = '/'+response.route; 
                }
            }
        });
    });

    $("#dissaprove").click(function () {
        swal({
            title: "Feedback / Remarks",
            text: "Please enter reason for disapproval:",
            type: "input",
            showCancelButton: true,
            closeOnConfirm: true,
            animation: "slide-from-top",
            inputPlaceholder: "Write something"
        },
        function(inputValue){
            if (inputValue === false) return false;
            
            if (inputValue === "") {
                swal.showInputError("You need to write something!");
                return false
            }

            $.ajax({
                data : {inputValue},
                url  : '/dissaprove/{{data[0]}}/{{info[1]}}/{{info[2]}}/view_hhrd_leave_forms/leave_form/'+inputValue,
                beforeSend: function(){
                    console.log('loading');
                    setVisible('#loading', true);
                },
                complete: function(){
                    console.log('done');
                    setVisible('#loading', false);
                },
                success: function(response){
                    if(response.data == 'success') {
                        window.location.href = '/'+response.route; 
                    }
                }
            });
            
            // swal("Nice!", "You wrote: " + inputValue, "success");
        });
    });


    $("#submit_btn").click(function () {
        $("#submit").click();
    })

    function printDiv(divName) {
        var printContents = "";
        var style = `<style>
                    .inpt {
                        border: none;
                        border-bottom: 1px solid black;
                    }

                    .inpt:focus {
                        outline: none;
                        border-bottom: 1px solid red;
                    }

                    select {
                        all: unset;
                        padding-right: 15px;
                        border-bottom: 1px solid;
                        background: url('static/img/dropdown.png') no-repeat right;
                        background-size: 16px;
                        color: black;
                    }</style>`;

        printContents += style;
        printContents += document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;

        document.body.innerHTML = printContents;

        $('.btn-group-vertical').css('display', 'none');
        $('.required-field').css('display', 'none');
        window.print();
        $('.btn-group-vertical').css('display', '');
        $('.required-field').css('display', '');

        document.body.innerHTML = originalContents;
    }


</script>
{% endblock %}