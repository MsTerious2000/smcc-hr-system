{% set active_page = "pending_travel" %}
{% extends "VP/header.html" %}
{% block index %}
<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">View Travel Order Form
        </h6>
        <!-- <a href="#" class="btn btn-success btn-sm" id="submit_btn"><i class="fas fa-paper-plane"></i> SUBMIT</a> -->
    </div>

    <!-- Card Body -->
    <div class="card-body" id="printableArea">
        <form id="submit-form">
            <center>
                <h4><b>Saint Michael College of Caraga</b></h4>
                <h6>Brgy. 4, Nasipit, Agusan del Norte, Philippines<br>Tel. No. +63 065 343-3251 / +63 005 283-3112 Fax
                    Np.
                    +63 085 008-0892<br><u>www.smccnasipit.edu.ph</u></h6>
                <br>
                <h4 style="font-weight: bolder;">TRAVEL ORDER FORM</h4>
            </center>
            <br>

            <p><b>Name</b>: 
				<input type="text" value="{{data[2]}}" class="inpt" style="width: 800;" readonly>
            </p>

            <table style="width: 100%;">
                <tbody>
                    <tr>
                        <td>
                            <p><b>Department:</b>
								<input type="text" value="{{data[20]}}" class="inpt" style="width: 200px;" readonly>
                            </p>
                        </td>
                        <td style="width: 30%;"></td>
                        <td>
                            <p><b>Travel Date:</b>
                                <input type="text" id="travel_date" name="travel_date" value="{{data[5]}}" class="inpt"
                                    style="width: 200px; margin-left: 70px;" readonly>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p><b>Date Filed:</b>
                                <input type="date" id="date_filed" name="date_filed" value="{{data[4]}}" class="inpt"
                                    style="width: 220px; margin-left: 12px;" readonly>
                            </p>
                        </td>
                        <td></td>
                        <td>
                            <p><b>Travel Time Duration:</b>
                                <input type="number" id="travel_time_duration" value="{{data[6]}}" min="1" name="travel_time_duration"
                                    class="inpt" readonly style="width: 145px; margin-left: 2px;"> Hour(s)
                            </p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br>

            <p><b>Reasons: </b></p>
            <textarea name="reasons" id="reasons" readonly>{{data[7]}}</textarea>
            <br>
            <br>

            <p><b>Destination/Area:</b>
                <input type="radio" readonly name="destination" {% if data[8] == 'Buenavista' %} checked="checked" {% endif %} value="Buenavista" style="margin-left: 20px;">Buenavista
                <input type="radio" readonly name="destination" {% if data[8] == 'Carmen' %} checked="checked" {% endif %} value="Carmen" style="margin-left: 20px;"> Carmen
                <input type="radio" readonly name="destination" {% if data[8] == 'Butuan City' %} checked="checked" {% endif %} value="Butuan City" style="margin-left: 20px;"> Butuan City
                <input type="radio" readonly name="destination" {% if data[8] == 'others' %} checked="checked" {% endif %} value="others" style="margin-left: 20px;"> Others
                (please
                specify):
                <input type="text" value="{{data[9]}}" name="specify" class="inpt" readonly>
            </p>
            <br>

            <center style="border: 1px solid black;">
                <p><b>VEHICLE PASS</b> (If applicable)</p>
                <p>
                    <input type="radio" name="vehicle_pass" value="YES" {% if data[10] == 'YES' %} checked="checked" {% endif %}> Yes
                    <input type="radio" name="vehicle_pass" value="NO" {% if data[10] == 'NO' %} checked="checked" {% endif %}> No
                    <br>
                    <br>
                    <input type="radio" name="vehicle" value="None" {% if data[11] == 'None' %} checked="checked" {% endif %}> None
                    <input type="radio" name="vehicle" value="VAN/FOTON" style="margin-left: 20px;" {% if data[11] == 'VAN/FOTON' %} checked="checked" {% endif %}> VAN/FOTON
                    <input type="radio" name="vehicle" value="HYUNDAI/L3" style="margin-left: 20px;" {% if data[11] == 'HYUNDAI/L3' %} checked="checked" {% endif %}>
                    HYUNDAI/L3
                    <input type="radio" name="vehicle" value="MULTICAB" style="margin-left: 20px;" {% if data[11] == 'MULTICAB' %} checked="checked" {% endif %}> MULTICAB
                    <input type="radio" name="vehicle" value="BUS" style="margin-left: 20px;" {% if data[11] == 'BUS' %} checked="checked" {% endif %}> BUS
                    <input type="radio" name="vehicle" value="ELF" style="margin-left: 20px;" {% if data[11] == 'ELF' %} checked="checked" {% endif %}> ELF
                    <br>
                    <br>

                <table style="width: 100%;">
                    <tbody>
                        <tr>
                            <td>
                                <p style="margin-left: 20px;"> Approved by: <input type="text" name="approved_by"
                                        class="inpt" value="{{data[12]}}" readonly></p>
                            </td>
                            <td style="width: 45%;"></td>
                            <td>Driver: <input type="text" value="{{data[13]}}" name="driver" class="inpt" readonly></td>
                        </tr>
                    </tbody>
                </table>
                </p>
            </center>
            <center>
                <div class="row" style="margin-top: 50px;">
                    <div class="col-sm-4">
                        <input type="text" name="employee_name_signature" class="inpt" value="{{data[2]}}"
                            style="text-align:center;"><br>
                        Employee's Name and Signature
                    </div>
                    <div class="col-sm-4">
                        <input type="text"  name="department_head" class="inpt" value="{{data[15]}}" style="text-align:center;" readonly><br>
                        Department Head/s
                    </div>
                    <div class="col-sm-4">
                        <input type="text" value="{{data[16]}}" name="head_human_resource_department" class="inpt" style="text-align:center;" readonly><br>
                        Head Human Resource Department
                    </div>
                </div>
            </center>
            <br>
            <center>
                <br>
                Approved By:<br><br><br>
                <input type="text" name="VP" value="{{info[1]}} {{info[2]}}" class="inpt" style="text-align:center;" readonly><br>
                VP-Administrative Affairs/VP-Academic Affairs
                <br>
                <br>
                <div style="border:1px solid black">
                    Note: Provide 2 copies, 1 for Human Resource, 2<sup>nd</sup> to Security Officer
                </div>
            </center>

            <div class="btn-group-vertical" style="position:fixed; top:100px; right:30px;">
                <a class="btn btn-primary btn-sm" id="print" onclick="printDiv('printableArea')"><i class="fas fa-print"></i> PRINT</a>
                {% if data[18] == 'VP' %}
                    <a class="btn btn-success btn-sm" id="submit_btn"><i class="fas fa-check"></i> APPROVE</a>
                    <button type="button" title="Cancel" class="btn btn-danger btn-sm" id="dissaprove"><i class="fas fa-thumbs-down"></i> DISAPPROVE</button>
                    <!-- <a href="/dissaprove/{{data[0]}}/{{info[1]}}/{{info[2]}}/view_vp_travel_order_forms/travel_order_form" class="btn btn-danger btn-sm"><i class="fas fa-thumbs-down"></i> DISAPPROVE</a> -->
                    <button type="submit" id="submit" style="display: none;"></button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<style type="text/css">
    @media print {
        body * {
            visibility: hidden;
        }

        #section-to-print,
        #section-to-print * {
            visibility: visible;
        }

        #section-to-print {
            width: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }
    }

    .inpt {
        border: none;
        border-bottom: 1px solid black;
    }

    .inpt:focus {
        outline: none;
        border-bottom: 1px solid red;
    }

    textarea {
        width: 1100px;
        height: 80px;
        border: none;
        border-bottom: 1px solid black;
    }

    select {
        all: unset;
        padding-right: 15px;
        border-bottom: 1px solid;
        background: url('static/img/dropdown.png') no-repeat right;
        background-size: 16px;
        color: black;
    }
</style>
<script src="{{url_for('static',filename='vendor/jquery/jquery-3.5.1.min.js')}}"></script>

<script type="text/javascript">
    $(':radio:not(:checked)').attr('disabled', true);

    function setVisible(selector, visible) {
        document.querySelector(selector).style.display = visible ? 'block' : 'none';
    }
        
    $('#submit-form').submit(function(e){
        e.preventDefault();
        const url = '/vp_approve_travel_order_form/{{data[0]}}';
        var formData = new FormData(this);
        $.ajax({
            data : formData,
            url  : url,
            type : 'POST',
            cache		: false,
            contentType	: false,
            processData	: false,
            beforeSend: function(){
                console.log('loading');
                setVisible('#loading', true);
            },
            complete: function(){
                console.log('done');
                setVisible('#loading', false);
            },
            success: function(response){
                if(response.data == 'success') {
                    window.location.href = '/'+response.route; 
                }
            }
        });
    });
    
    $("#dissaprove").click(function () {
        swal({
                title: "Feedback / Remarks",
                text: "Please enter reason for disapproval:",
                type: "input",
                showCancelButton: true,
                closeOnConfirm: true,
                animation: "slide-from-top",
                inputPlaceholder: "Write something"
            },
            function(inputValue){
                if (inputValue === false) return false;
                
                if (inputValue === "") {
                    swal.showInputError("You need to write something!");
                    return false
                }

                $.ajax({
                    data : {inputValue},
                    url  : '/dissaprove/{{data[0]}}/{{info[1]}}/{{info[2]}}/view_vp_travel_order_forms/travel_order_form/'+inputValue,
                    beforeSend: function(){
                        console.log('loading');
                        setVisible('#loading', true);
                    },
                    complete: function(){
                        console.log('done');
                        setVisible('#loading', false);
                    },
                    success: function(response){
                        if(response.data == 'success') {
                            window.location.href = '/'+response.route; 
                        }
                    }
                });
                
                // swal("Nice!", "You wrote: " + inputValue, "success");
            });
    });

    $("#submit_btn").click(function () {
        $("#submit").click();
    })

    $('#reasons').bind("change", function () {
        var val = $(this).val();
        $(this).attr('text', val);
    });

    $('#travel_date').bind("change", function () {
        var val = $(this).val();
        $(this).attr('value', val);
    });

    $('#date_filed').bind("change", function () {
        var val = $(this).val();
        $(this).attr('value', val);
    });

    $('#travel_time_duration').bind("change", function () {
        var val = $(this).val();
        $(this).attr('value', val);
    });

    function printDiv(divName) {
        $('#reasons').text($('#reasons').val());
        for (const option of document.querySelectorAll('option:checked')) {
            option.setAttribute('selected', '')
        }

        if ($('input[name=destination]:checked').length != 0) {
            var value = document.querySelector('input[name="destination"]:checked').value;
            $("input[name=destination][value='" + value + "']").attr('checked', 'checked');
        }
        
        var printContents = "";
        var style = `<style>
                    .inpt {
                        border: none;
                        border-bottom: 1px solid black;
                    }

                    .inpt:focus {
                        outline: none;
                        border-bottom: 1px solid red;
                    }

                    textarea {
                        width: 1100px;
                        height: 80px;
                        border: none;
                        border-bottom: 1px solid black;
                    }

                    select {
                        all: unset;
                        padding-right: 15px;
                        border-bottom: 1px solid;
                        background: url('static/img/dropdown.png') no-repeat right;
                        background-size: 16px;
                        color: black;
                    }</style>`;

        printContents += style;
        printContents += document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;


        document.body.innerHTML = printContents;

        $('.btn-group-vertical').css('display', 'none');
        $('.required-field').css('display', 'none');
        window.print();
        $('.btn-group-vertical').css('display', '');
        $('.required-field').css('display', '');

        document.body.innerHTML = originalContents;
    }


</script>
{% endblock %}